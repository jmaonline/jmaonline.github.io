define(["jquery","underscore"],function(a,b){"use strict";function c(b){var c="#";this.config={},this.state={data:{},currentRoot:"",currentNode:"",currentLeaf:"",target:"",history:{}},b?this.config=a.extend({},r,b):this.config=a.extend({},r),this.config.navDestination=a("aside").find(".nav-home"),this.state.$navWrapper=a(c+this.config.navWrapperClass),this.state.$iconPanelWrapper=a(c+this.config.iconPanelClass),this.state.$panelWrapper=a(c+this.config.panelClass),this.makeMobNav(),this.bindEventListeners(),this.initiateTraversal()}function d(){var b=a('<ul class="nav-back"><li><a href="#" class="'+this.config.backButtonClass+'">Back</a></li></ul>'),c=a("<nav class='navigation mob-nav'></nav>"),d=a("<ul class='js-nav-items'></ul>");this.state.$navWrapper.append(c),c.append(b),c.append(d),this.state.$mobNav=c.find("ul.js-nav-items"),this.state.$nextButton=c.find("."+this.config.backButtonClass)}function e(a){return!b.isEmpty(this.state.data[a])}function f(a,b){a.lastIndexOf("/")==a.length-1&&(a=a.substr(0,a.length-1));var c,d=this,e={},f={},g=d.state.data[d.state.currentRoot];if(c="/"==a.substring(0,1)?a.substring(1).split("/"):a.substring(0).split("/"),void 0==g)return window.location.href=a,!0;if(c&&(c.length>1||"more-section"==this.state.currentRoot)){c.length>1&&"more-section"!=this.state.currentRoot&&c.shift(),b&&c.pop();for(var h=0,i=c.length;h<i&&e;h++)e=0===h?g[c[h]]:e[c[h]];e&&e._meta&&(d.state.currentNode=e._meta.p),f=e}return f}function g(){var b=a.proxy(this.traverseHandler,this),c=a.proxy(this.iconPanelSwitcher,this);this.state.$iconPanelWrapper.on("click","ul li a",c),this.state.$navWrapper.on("click","."+this.config.navItemClass,b),this.state.$navWrapper.on("click","."+this.config.backButtonClass,b),h()}function h(){0==a(".nav-sidebar .icon-panel-nav.active .sub-nav-wrapper").length?a(".nav-sidebar .icon-panel-nav.active").find("a:last").focusout(function(){a(".nav-sidebar .nav-header .btn-close").focus()}):a(".nav-sidebar .icon-panel-nav.active").find("li:last").focusout(function(){a(".nav-sidebar .nav-header .btn-close").focus()})}function i(c){var d=this,e="a"!==c.target.nodeName.toLowerCase()?a(c.target).closest("a"):a(c.target),f=e.attr("data-panel");b.isEmpty(f)||(this.state.$iconPanelWrapper.find("ul li a").removeClass("active"),this.state.$iconPanelWrapper.find("ul li a[data-panel='"+f+"']").addClass("active"),this.state.$panelWrapper.find("ul li").removeClass("active"),this.state.$panelWrapper.find("#"+f).addClass("active"),h(),this.readyTraversal(),d.swapNavigation())}function j(){this.state.$mobNav.parent().removeClass("ani-pull ani-push ani-back-pull ani-back-push"),this.state.$mobNav.parent().addClass("ani-back-push"),this.state.$panelWrapper.addClass("ani-back-pull"),this.state.$navWrapper.removeClass("is-mob-active")}function k(b,c,d){var e=this,f=e.config.template,g={data:{root:b._meta,children:b,highlight:d}},h=e.state.$mobNav.parent(".mob-nav"),i=h.clone();i.removeClass("ani-pull ani-push ani-back-pull ani-back-push"),h.removeClass("ani-pull ani-push ani-back-pull ani-back-push"),this.state.$navWrapper.hasClass("is-mob-active")||this.state.$navWrapper.addClass("is-mob-active");var j=f(g);i.find("ul.js-nav-items")[0].innerHTML="",i.find("ul.js-nav-items").append(a(j)),c?(h.before(i),h.addClass("ani-back-push"),i.addClass("ani-back-pull")):(h.after(i),h.addClass("ani-push"),i.addClass("ani-pull")),e.state.$mobNav=i.find("ul.js-nav-items"),e.state.$mobNav.find("a:last").on("focusout",function(){a(".nav-sidebar .nav-header .btn-close").focus()}),e.state.$nextButton=i.find("."+e.config.backButtonClass),window.setTimeout(function(){h[0].innerHTML="",h.remove(),h=null},500)}function l(b){b.preventDefault();var c=this,d=a(b.currentTarget),e=d.hasClass(c.config.backButtonClass),f=e?c.state.currentNode:d.attr("href");return a("body").hasClass("has-openSidebar")&&0!=f.indexOf("http")?void c.traverse(f,e,!1,""):(window.location.href=a(b.currentTarget).attr("href"),!0)}function m(){var a,c=this;!c.config.jump||b.isEmpty(c.config.jump)||c.config.jump.jumped?a="":(c.config.jump.jumped=!0,a=c.state.currentNode=c.config.jump.url),c.traverse(a,!1,!0,"")}function n(c,d,e,f){var g=this,h={},i=a.proxy(g.readyTraversal,g),j=a.proxy(g.findCurrentNode,g),k={};return g.state.currentNode=c,i().done(function(){h=j(c,d),k=h,b.isEmpty(h)||1===b.keys(h).length?d?g.swapNavigation():b.has(h,"_meta")&&(e?g.traverse(c.substring(0,c.lastIndexOf("/")),!1,!1,c):window.location.href=h._meta.p+"/"):g.render(h,d,f)}).fail(function(){}),!1}function o(){var b=a.Deferred(),c=this,d=c.getCurrentRoot(),e=this.isNavLoaded(d),f=a.proxy(c.loadNav,c);return c.state.currentRoot=d,e||"sign-in"===d?b.resolve():f(d).done(function(a){c.state.data[d]=a,b.resolve()}).fail(function(){b.reject()}),b}function p(b){var c=a.Deferred();return"more-section"!=this.state.currentRoot?a.ajax({url:this.config.navService.replace("ROOT_URL",this.state.currentRoot),type:"GET",dataType:"json"}).done(function(a){c.resolve(a)}).fail(function(a){c.reject(a)}):(this.state.currentRoot="personal-banking",a.ajax({url:this.config.navService.replace("ROOT_URL.ln",this.state.currentRoot+".more-ln"),type:"GET",dataType:"json"}).done(function(a){c.resolve(a)}).fail(function(a){c.reject(a)}),this.state.currentRoot="more-section"),c}function q(){var a=this.state.$iconPanelWrapper.find("ul li a.active"),b="";return a.length>0&&(b=a.attr("data-panel")),b}var r={navSources:["signin","personal-banking","business-banking","corporate","more"],pathPrefix:"/content/wbc/en",root:"personal-banking",jump:{url:"/personal-banking/bank-accounts/transaction/choice/online-identity-verification",jumped:!1},defaultSource:"personal",navService:"/ui/assets/js/components/web/ui/ROOT_URL.json",navWrapperClass:"nav-wrapper",backButtonClass:"mob-back-button",iconPanelClass:"icon-panel-wrapper",panelClass:"main-nav",navItemClass:"sub-nav-item a",template:b.template('<li class="mob-navigation <%= data.root.t%>">      <span class="category-heading-mob"><%= data.root.t%></span>      <div class="sub-nav-wrapper">        <ul class="category-landing lists-navigation">          <li><a href="<%= data.root.p%>/" class="landing">All <%= data.root.t%></a></li>        </ul>        <ul class="sub-nav lists-navigation">          <li>            <ul class="lists-navigation">            <%for (var k in data.children) {%>               <%if (k === "_meta") {%>                   <%continue;%>               <%}%>              <li class="sub-nav-item"><a class=<%=data.highlight && data.highlight === data.children[k]._meta.p ? "highlight-leaf" : "na" %> href="<%= data.children[k]._meta.p%>/"><%= data.children[k]._meta.t%><p><%= data.children[k]._meta.d%></p></a></li>            <%}%>            </ul>          </li>        </ul>      </div>    </li>')};return c.prototype={isNavLoaded:e,traverse:n,makeMobNav:d,iconPanelSwitcher:i,swapNavigation:j,readyTraversal:o,loadNav:p,bindEventListeners:g,render:k,findCurrentNode:f,traverseHandler:l,initiateTraversal:m,getCurrentRoot:q},c});/* Version:19.0 16815c55e*/